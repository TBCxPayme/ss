<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | TBCxPayme CUP</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background: radial-gradient(circle at center, #02171a, #000a0c);
      color: #e8f8ff;
      font-family: "Orbitron", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px;
    }

    #login {
      text-align: center;
      margin-top: 100px;
    }

    #adminPanel {
      display: none;
      width: 90%;
      max-width: 800px;
    }

    h1 {
      color: #00ffff;
      text-shadow: 0 0 10px #00aaff;
    }

    .match {
      background: rgba(0, 255, 255, 0.05);
      border: 1px solid #00ffff;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    input {
      background: rgba(0, 0, 0, 0.4);
      color: #00ffff;
      border: 1px solid #00ffff;
      border-radius: 5px;
      padding: 5px;
      margin: 3px;
      text-align: center;
      font-family: "Orbitron", sans-serif;
    }

    button {
      background: #0099ff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin: 10px 0;
      font-family: "Orbitron", sans-serif;
      transition: 0.3s;
    }

    button:hover {
      background: #00bbff;
    }

    #status {
      margin-top: 10px;
      font-size: 1em;
      color: #00ff99;
    }

    #error {
      color: #ff5555;
      display: none;
    }

    #tokenInput {
      width: 320px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div id="login">
    <h2>üîê –í—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
    <input type="password" id="passwordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" /><br><br>
    <button onclick="login()">–í–æ–π—Ç–∏</button>
    <p id="error">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</p>
  </div>

  <div id="adminPanel">
    <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–æ–º</h1>

    <label>üîë GitHub Token:</label><br>
    <input type="password" id="tokenInput" placeholder="–í–≤–µ–¥–∏—Ç–µ GitHub —Ç–æ–∫–µ–Ω"><br>
    <button onclick="loadData()">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å data.json</button>

    <div id="matches"></div>
    <button onclick="saveData()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <div id="status"></div>
  </div>

  <script>
    const PASSWORD = "TBCxPayme2025";
    const REPO = "TBCxPayme/CyberSport";
    const FILE_PATH = "data.json";
    let sha = null;
    let matches = [];

    function login() {
      const input = document.getElementById("passwordInput").value;
      if (input === PASSWORD) {
        document.getElementById("login").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
      } else {
        document.getElementById("error").style.display = "block";
      }
    }

    async function loadData() {
      const token = document.getElementById("tokenInput").value.trim();
      if (!token) return alert("–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω!");

      try {
        const res = await fetch(`https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`, {
          headers: { Authorization: `token ${token}` }
        });
        const data = await res.json();
        sha = data.sha;
        const json = JSON.parse(atob(data.content));
        matches = json.matches;
        renderMatches();
        document.getElementById("status").textContent = "‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!";
      } catch (err) {
        document.getElementById("status").textContent = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö!";
      }
    }

    function renderMatches() {
      const container = document.getElementById("matches");
      container.innerHTML = "";
      matches.forEach((m, i) => {
        container.innerHTML += `
          <div class="match">
            <input value="${m.teamA}" onchange="updateMatch(${i}, 'teamA', this.value)">
            <input type="number" value="${m.scoreA}" onchange="updateMatch(${i}, 'scoreA', this.value)">
            <span>VS</span>
            <input value="${m.teamB}" onchange="updateMatch(${i}, 'teamB', this.value)">
            <input type="number" value="${m.scoreB}" onchange="updateMatch(${i}, 'scoreB', this.value)">
          </div>`;
      });
    }

    function updateMatch(i, key, val) {
      matches[i][key] = key.includes("score") ? parseInt(val) : val;
    }

    async function saveData() {
      const token = document.getElementById("tokenInput").value.trim();
      if (!token) return alert("–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω!");

      const body = {
        message: "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–∞",
        content: btoa(JSON.stringify({ matches }, null, 2)),
        sha
      };

      try {
        const res = await fetch(`https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`, {
          method: "PUT",
          headers: {
            Authorization: `token ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify(body)
        });

        if (res.ok) {
          document.getElementById("status").textContent = "‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!";
        } else {
          document.getElementById("status").textContent = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏!";
        }
      } catch {
        document.getElementById("status").textContent = "‚ö†Ô∏è –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞!";
      }
    }
  </script>
</body>
</html>
